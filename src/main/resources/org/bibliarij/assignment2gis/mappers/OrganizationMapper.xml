<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- MyBatis mapper for Organization entity -->
<mapper namespace="org.bibliarij.assignment2gis.mappers.OrganizationMapper">

    <!-- Get all entities -->
    <select id="getAllEntities" resultType="org.bibliarij.assignment2gis.entities.Organization">
        SELECT * FROM public.organization;
    </select>

    <!-- Get entity by id -->
    <select id="get" resultType="org.bibliarij.assignment2gis.entities.Organization">
        SELECT * FROM public.organization org WHERE org.id = #{id};
    </select>

    <!-- Get organizations by name -->
    <select id="getByName" resultType="org.bibliarij.assignment2gis.entities.Organization">
        SELECT * FROM public.organization org WHERE org.name = #{name};
    </select>

    <!-- Get organizations by creation/update date-time -->
    <select id="getByCreationUpdateDateTime" resultType="org.bibliarij.assignment2gis.entities.Organization">
        SELECT * FROM public.organization org WHERE org.creation_update_date_time >= #{creationUpdateDateTime};
    </select>

    <!-- Insert entity -->
    <insert
            id="insert"
            parameterType="org.bibliarij.assignment2gis.entities.Organization"
            useGeneratedKeys="true"
            keyProperty="id"
            keyColumn="id"
    >
        INSERT INTO public.organization(
            name, city_id, street_id, house_number, activity_field, website_url, creation_update_date_time
        )
        VALUES (
            #{name},
            #{city.id},
            #{street.id},
            #{houseNumber},
            #{activityField},
            #{websiteUrl},
            #{creationUpdateDateTime}
        );
    </insert>

    <!-- Insert phone for organization -->
    <insert id="insertPhone" useGeneratedKeys="true" keyProperty="id" keyColumn="id">
        INSERT INTO public.phone(phone, organization_id) VALUES (#{phone}, #{organizationId});
    </insert>

    <!-- Update entity -->
    <update id="update" parameterType="org.bibliarij.assignment2gis.entities.Organization">
        UPDATE public.organization
        SET
            name = #{name},
            city_id = #{city.id},
            street_id = #{street.id},
            house_number = #{houseNumber},
            activity_field = #{activityField},
            website_url = #{websiteUrl},
            creation_update_date_time = #{creationUpdateDateTime}
        WHERE id = #{id};
    </update>

    <!-- Delete phone from organization -->
    <delete id="deletePhone">
        DELETE FROM public.phone phone WHERE phone.phone = #{phone} AND phone.organization_id = #{organizationId};
    </delete>
</mapper>